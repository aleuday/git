first code



import pymysql
import os
import json

# Environment Variables
rds_host = os.environ['RDS_HOST']
db_username = os.environ['DB_USER']
db_password = os.environ['DB_PASSWORD']
db_name = os.environ['DB_NAME']
db_port = int(os.environ.get('DB_PORT', 3306))

def lambda_handler(event, context):
    try:
        # First connect WITHOUT database to create DB if not exists
        initial_connection = pymysql.connect(
            host=rds_host,
            user=db_username,
            passwd=db_password,
            port=db_port,
            connect_timeout=5
        )
        with initial_connection.cursor() as cursor:
            cursor.execute(f"CREATE DATABASE IF NOT EXISTS {db_name};")
        initial_connection.close()

        # Now connect WITH database
        connection = pymysql.connect(
            host=rds_host,
            user=db_username,
            passwd=db_password,
            db=db_name,
            port=db_port,
            connect_timeout=5
        )
        with connection.cursor() as cursor:
            cursor.execute("""
                CREATE TABLE IF NOT EXISTS employees (
                    id INT AUTO_INCREMENT PRIMARY KEY,
                    name VARCHAR(100),
                    position VARCHAR(100),
                    salary DECIMAL(10,2)
                );
            """)
            cursor.execute("""
                INSERT INTO employees (name, position, salary)
                VALUES ('Alice Johnson', 'DevOps Engineer', 85000.00);
            """)
            connection.commit()
            cursor.execute("SELECT * FROM employees LIMIT 5;")
            rows = cursor.fetchall()

        return {
            'statusCode': 200,
            'body': json.dumps({'employees': rows}, default=str)
        }
    except Exception as e:
        print("ERROR:", e)
        return {
            'statusCode': 500,
            'body': json.dumps({'error': str(e)})
        }





sudo yum install python3-pip zip -y
mkdir python
cd python
pip3 install pymysql -t .
cd ..
zip -r pymysql-layer.zip python



in configuration 

go to rds databses then conncect to rds


attach iam role to ec2 to create bucket and upload dependencies

aws s3 mb s3://my-lambda-layers-simon --region ap-south-1


aws s3 cp pymysql-layer.zip s3://mybucketaleuday/pymysql-layer.zip





Lambda Environment Variables


RDS_HOST

DB_NAME

DB_PORT

DB_USER

DB_PASSWORD






call through secret manager










